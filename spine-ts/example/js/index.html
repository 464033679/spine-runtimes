<html>
<script src="../../build/spine.js"></script>
<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
<body>
<canvas id="canvas" style="width: 640; height: 480"></canvas>
</body>
<script>

var canvas = null;
var shader = null;
var mesh = null;
var gl = null;
var mvp = new spine.webgl.Matrix4();
var assetManager = new spine.webgl.AssetManager();
var texture = null;
var atlas = null;

function init() {    
    // setup canvas and WebGL context
    canvas = document.getElementById("canvas");
    canvas.width = 640;
    canvas.height = 480;
    gl = canvas.getContext("webgl") || canvas.getContext("experimental-webgl");        
    spine.webgl.init(gl);
    
    // Create a simple shader, mesh and MVP matrix
    shader = spine.webgl.Shader.newColoredTextured();
    mesh = new spine.webgl.Mesh([new spine.webgl.Position2Attribute(), 
                                 new spine.webgl.ColorAttribute(), 
                                 new spine.webgl.TexCoordAttribute()],
                                4, 6);
    mesh.setVertices([
         0, 0, 1, 1, 1, 1, 0, 0,
         639, 0, 1, 1, 1, 1, 1, 0,
         639, 479, 1, 1, 1, 1, 1, 1,
         0, 479, 1, 1, 1, 1, 0, 1
    ]);
    mesh.setIndices([0, 1, 2, 2, 3, 0]);
    mvp.ortho2d(0, 0, 639, 479);

    // Tell AssetManager to load a few resources, then
    // hand control to load() function
    assetManager.loadText("resources/spineboy.json");
    assetManager.loadText("resources/spineboy.atlas");
    assetManager.loadTexture("resources/spineboy.png");
    requestAnimationFrame(load);
}

function load() {
    if (assetManager.isLoadingComplete()) {
        texture = assetManager.get("resources/spineboy.png");

        atlas = new spine.webgl.TextureAtlas(assetManager.get("resources/spineboy.atlas"), function(path) {
            return assetManager.get("resources/" + path);
        });

        requestAnimationFrame(render);
    }
    else requestAnimationFrame(load);
}

function render() {
    gl.clearColor(0, 1, 0, 1);
    gl.clear(gl.COLOR_BUFFER_BIT);

    shader.bind();
    shader.setUniformi(spine.webgl.Shader.SAMPLER, 0);
    shader.setUniform4x4f(spine.webgl.Shader.MVP_MATRIX, mvp.values);
    texture.bind();
    mesh.render(shader, gl.TRIANGLES);
    texture.unbind();
    shader.unbind();    

    requestAnimationFrame(render);
}

(function() {
    init();
})();

</script>
</html>